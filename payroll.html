<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>薪資計算機</title>
  <meta name="description" content="將額度計算機的結果（政府補助＋自付）與 AA 加成整合，快速算出居服薪資（6/4）。由 hori 製作。">

  <link rel="icon" type="image/x-icon" href="YORU.ico" />
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="topbar-fixed.css" />
  <!-- 仍載入你的 script.js 以保留導覽高亮等共用行為；本頁的薪資計算獨立於此檔，不會衝突 -->
  <script src="script.js" defer></script>

  <style>
    /* 本頁沿用你的浮水印樣式 */
    :root{
      --wm-text: "@hori版權所有";
      --wm-size: 36px;
      --wm-angle: -25deg;
      --wm-alpha: 0.05;
      --wm-shift: 120px;
    }
    .watermark { position: fixed; inset: 0; pointer-events: none; z-index: 9999; overflow: hidden; }
    .wm-item{
      position: absolute; font-weight: 700; font-size: var(--wm-size);
      color: rgba(0,0,0,var(--wm-alpha)); transform: rotate(var(--wm-angle));
      white-space: nowrap; user-select: none; will-change: transform;
      animation: wm-sway var(--dur, 12s) ease-in-out infinite alternate;
    }
    @keyframes wm-sway{ 0%{transform:translateX(0) rotate(var(--wm-angle));}
      100%{transform:translateX(var(--wm-shift)) rotate(var(--wm-angle));} }
    @media print{ .watermark{ opacity:.08; } }

    /* 本頁小元件 */
    .kpi{ display:flex; gap:16px; flex-wrap:wrap; }
    .kpi .box{
      flex:1 1 260px; background:#fff; border:1px solid var(--line); border-radius:12px; padding:16px;
      display:flex; flex-direction:column; gap:6px; box-shadow:0 1px 2px rgba(0,0,0,.05);
    }
    .kpi .box .lbl{ color:#7a7557; font-weight:700; }
    .kpi .box .num{ font-size:24px; font-weight:900; color:#2e7d32; }

    .form-grid{
      display:grid; gap:12px; grid-template-columns:1fr 1fr; align-items:center;
    }
    .form-grid .field{
      display:flex; gap:10px; align-items:center; justify-content:flex-end;
      background:#fff; border:1px solid var(--line); border-radius:10px; padding:8px 12px;
    }
    .form-grid .field label{ margin-right:auto; font-weight:700; color:#333; }
    .form-grid input[type="number"]{
      width:120px; height:34px; text-align:right; font-size:15px; border-radius:8px; padding:2px 8px;
    }
    @media (max-width:860px){ .form-grid{ grid-template-columns:1fr; } }

    .addon-note{ color:#7a7557; font-size:13px; margin-top:8px; }
    .formula{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
  </style>
</head>
<body>
  <!-- 浮水印 -->
  <div class="watermark" aria-hidden="true">
    <span class="wm-item" style="top:5%; left:5%; --dur:9s;">@hori版權所有</span>
    <span class="wm-item" style="top:5%; left:35%; --dur:11s;">@hori版權所有</span>
    <span class="wm-item" style="top:5%; left:65%; --dur:10s;">@hori版權所有</span>
    <span class="wm-item" style="top:25%; left:10%; --dur:13s;">@hori版權所有</span>
    <span class="wm-item" style="top:25%; left:40%; --dur:12s;">@hori版權所有</span>
    <span class="wm-item" style="top:25%; left:70%; --dur:14s;">@hori版權所有</span>
    <span class="wm-item" style="top:50%; left:5%; --dur:10s;">@hori版權所有</span>
    <span class="wm-item" style="top:50%; left:35%; --dur:11s;">@hori版權所有</span>
    <span class="wm-item" style="top:50%; left:65%; --dur:9s;">@hori版權所有</span>
    <span class="wm-item" style="top:75%; left:10%; --dur:13s;">@hori版權所有</span>
    <span class="wm-item" style="top:75%; left:40%; --dur:12s;">@hori版權所有</span>
    <span class="wm-item" style="top:75%; left:70%; --dur:10s;">@hori版權所有</span>
    <span class="wm-item" style="top:90%; left:15%; --dur:11s;">@hori版權所有</span>
    <span class="wm-item" style="top:90%; left:45%; --dur:10s;">@hori版權所有</span>
    <span class="wm-item" style="top:90%; left:75%; --dur:12s;">@hori版權所有</span>
  </div>

  <!-- 頂部導覽（與其他頁一致；右側用 actions-ghost 佔位） -->
  <header class="topbar">
    <div class="brand">
      <a href="https://github.com/hori07/longterm-care-calculator/tree/main" target="_blank" class="logo-link">
        <img src="org-logo.png" alt="logo" onerror="this.style.opacity=0.2" />
      </a>
      <span class="site-title">薪資計算機</span>
    </div>

    <nav class="nav-links">
      <a href="index.html">額度計算機</a>
      <a href="payroll.html">薪資計算機</a>
      <a href="care-info.html">長照相關資訊</a>
      <a href="news.html">最新公告</a>
      <a href="contact.html">聯繫方式</a>
      <a href="about.html">關於我們</a>
    </nav>

    <div class="actions actions-ghost">
      <button class="btn pill btn-orange" type="button">B單位</button>
      <button class="btn pill btn-green"  type="button">重置</button>
      <button class="btn pill btn-gray"   type="button">列印</button>
    </div>
  </header>

  <div class="divider"></div>

  <main class="container">
    <!-- KPI 區：一眼看總薪資 -->
    <section class="card" style="margin-bottom:16px;">
      <h1 class="card-title" style="font-size:22px;">居服薪資（6/4）</h1>
      <p class="hint">將「額度計算機」的結果貼過來，再加上 AA 加成，一鍵算出本月薪資。</p>

      <div class="kpi" style="margin-top:10px;">
        <div class="box">
          <div class="lbl">政府補助（含你在額度計算機內的 BA/GA/SC 補助）</div>
          <div class="num" id="plStatGov">0</div>
        </div>
        <div class="box">
          <div class="lbl">自付總計（案家自付）</div>
          <div class="num" id="plStatSelf">0</div>
        </div>
        <div class="box">
          <div class="lbl">AA 加成合計</div>
          <div class="num" id="plStatAA">0</div>
        </div>
        <div class="box">
          <div class="lbl">本月薪資（6/4）</div>
          <div class="num" id="plStatTotal">0</div>
        </div>
      </div>
    </section>

    <!-- 來源金額（從額度計算機帶入的兩個數字） -->
    <section class="card">
      <h2 class="card-title">① 來自「額度計算機」的金額</h2>
      <div class="form-grid" style="margin-top:8px;">
        <div class="field">
          <label for="plGov">政府補助：</label>
          <input id="plGov" type="number" min="0" step="1" value="0" />
        </div>
        <div class="field">
          <label for="plSelf">自付總計：</label>
          <input id="plSelf" type="number" min="0" step="1" value="0" />
        </div>
      </div>
      <p class="hint" style="margin-top:10px;">對應到首頁右卡「政府補助」「自付總計」兩行，直接輸入金額即可。</p>
    </section>

    <!-- AA 加成（與首頁共用 localStorage：addons） -->
    <section class="card">
      <h2 class="card-title">② AA 加成次數</h2>
      <div class="row space-between">
        <span class="hint">與首頁共用加成次數（localStorage: <code>addons</code>）。你可在這裡單獨調整，不影響首頁。</span>
        <div class="row">
          <button class="btn" id="btnSaveAA" type="button">儲存加成次數</button>
          <button class="btn btn-gray" id="btnClearAA" type="button" style="margin-left:8px;">清空</button>
        </div>
      </div>

      <div class="addon" style="margin-top:10px;">
        <div class="addon-head">
          <span>項目（AA）</span>
          <span class="text-right">次數</span>
        </div>
        <div id="aaRows" class="addon-body"></div>
      </div>
      <div class="addon-note">單價：AA05 200、AA06 200、AA08 385、AA09 770、AA11 50（與首頁一致）</div>
    </section>

    <!-- 公式與列印 -->
    <section class="card">
      <h2 class="card-title">③ 計算公式</h2>
      <p class="hint">
        <span class="formula">薪資 = (政府補助 + 自付總計 + AA 加成合計) × 0.6</span>
      </p>
      <div class="row" style="justify-content:flex-end; gap:10px; margin-top:8px;">
        <button class="btn btn-gray" onclick="window.print()">列印</button>
      </div>
    </section>
  </main>

  <footer id="bottomDock" class="footerbar">
    <div class="foot">
      <span class="ok">※ 本頁僅計算 6/4 薪資，若你有其它津貼/罰款/代墊，請另行加減。</span>
    </div>
  </footer>

  <!-- 本頁專屬：獨立薪資計算（不改動你的 script.js） -->
  <script>
    (function(){
      const $ = s => document.querySelector(s);
      const N = v => (isFinite(+v) ? +v : 0);
      const F = v => new Intl.NumberFormat('zh-Hant-TW', { maximumFractionDigits: 0 }).format(v);

      // 與首頁一致的 AA 單價
      const AA_PRICE = { AA05:200, AA06:200, AA08:385, AA09:770, AA11:50 };
      const AA_LIST  = Object.keys(AA_PRICE);

      // 產生 AA 列、載入 localStorage
      function renderAA(){
        const host = $('#aaRows'); host.innerHTML = '';
        const saved = JSON.parse(localStorage.getItem('addons') || '{}');
        AA_LIST.forEach(code=>{
          const row = document.createElement('div');
          row.className = 'addon-row';
          row.innerHTML = \`
            <div>\${code}</div>
            <div class="addon-inputs">
              <input type="number" id="\${code}_count" value="\${toInt(saved[\`\${code}_count\`])}" min="0" step="1" />
            </div>\`;
          host.appendChild(row);
        });
      }

      function toInt(v){
        if (typeof v === "number") return Number.isFinite(v) ? Math.trunc(v) : 0;
        if (v === null || v === undefined) return 0;
        const fw={'０':'0','１':'1','２':'2','３':'3','４':'4','５':'5','６':'6','７':'7','８':'8','９':'9','，':',','．':'.','＋':'+','－':'-'};
        let s=String(v).replace(/[０-９，．＋－]/g,ch=>fw[ch]??ch);
        s=s.replace(/,/g,'').trim();
        const m=s.match(/^[+-]?\\d+/);
        return m?parseInt(m[0],10):0;
      }

      function calcAA(){
        let total = 0;
        AA_LIST.forEach(code=>{
          const cnt = toInt($('#'+code+'_count')?.value);
          total += cnt * (AA_PRICE[code]||0);
        });
        return total;
      }

      function recompute(){
        const gov  = N($('#plGov')?.value);
        const self = N($('#plSelf')?.value);
        const aa   = calcAA();
        const total = Math.round((gov + self + aa) * 0.6);

        $('#plStatGov').textContent  = F(gov);
        $('#plStatSelf').textContent = F(self);
        $('#plStatAA').textContent   = F(aa);
        $('#plStatTotal').textContent= F(total);
      }

      function wire(){
        $('#plGov').addEventListener('input', recompute);
        $('#plSelf').addEventListener('input', recompute);
        document.querySelectorAll('#aaRows input[type="number"]').forEach(inp=>{
          inp.addEventListener('input', recompute);
        });

        $('#btnSaveAA').addEventListener('click', ()=>{
          const data = {};
          AA_LIST.forEach(code=>{
            data[\`\${code}_count\`] = toInt($('#'+code+'_count').value);
          });
          localStorage.setItem('addons', JSON.stringify(data));
          alert('AA 加成次數已儲存（與首頁共用）。');
        });

        $('#btnClearAA').addEventListener('click', ()=>{
          AA_LIST.forEach(code=>{ const el=$('#'+code+'_count'); if(el) el.value=0; });
          recompute();
        });
      }

      // 自動帶入查詢參數（可選）：?gov=12345&self=6789
      function applyQuery(){
        const p = new URLSearchParams(location.search);
        if (p.has('gov'))  $('#plGov').value  = toInt(p.get('gov'));
        if (p.has('self')) $('#plSelf').value = toInt(p.get('self'));
      }

      // 啟動
      renderAA();
      applyQuery();
      wire();
      recompute();
    })();
  </script>

  <!-- 防拷（與首頁一致；如不需可移除） -->
  <script>
    document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('keydown', e => {
      if ((e.ctrlKey || e.metaKey) && ['u','s','p'].includes(e.key.toLowerCase())) e.preventDefault();
      if (e.key === 'F12') e.preventDefault();
    });
    document.addEventListener('selectstart', e => e.preventDefault());
    document.addEventListener('copy', e => e.preventDefault());
  </script>
</body>
</html>
