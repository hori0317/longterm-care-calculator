<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>薪資計算機</title>
  <meta name="description" content="輸入本月 AA / BA / GA / SC 的支數，計總額並依比例拆薪；右上角提供列印與清空。右側即時比對勞健保扣款，得出實領。">

  <link rel="icon" type="image/x-icon" href="YORU.ico" />
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="topbar-fixed.css" />
  <script src="script.js" defer></script>

  <style>
    :root{ --wm-text:"@hori版權所有"; --wm-size:36px; --wm-angle:-25deg; --wm-alpha:.05; --wm-shift:120px; }
    .watermark{ position:fixed; inset:0; pointer-events:none; z-index:9999; overflow:hidden; }
    .wm-item{ position:absolute; font-weight:700; font-size:var(--wm-size); color:rgba(0,0,0,var(--wm-alpha));
      transform:rotate(var(--wm-angle)); white-space:nowrap; user-select:none; animation:wm-sway var(--dur,12s) ease-in-out infinite alternate; }
    @keyframes wm-sway{ 0%{transform:translateX(0) rotate(var(--wm-angle));} 100%{transform:translateX(var(--wm-shift)) rotate(var(--wm-angle));} }
    @media print{ .watermark{ opacity:.08; } }

    /* 本頁小元件 */
    .kpi{ display:flex; gap:16px; flex-wrap:wrap; }
    .kpi .box{ flex:1 1 240px; background:#fff; border:1px solid var(--line); border-radius:12px; padding:16px;
      display:flex; flex-direction:column; gap:6px; box-shadow:0 1px 2px rgba(0,0,0,.05); }
    .kpi .box .lbl{ color:#7a7557; font-weight:700; }
    .kpi .box .num{ font-size:24px; font-weight:900; color:#2e7d32; }
    .tbl{ width:100%; border-collapse:separate; border-spacing:0; background:#fff; border:1px solid var(--line); border-radius:12px; overflow:hidden; }
    .tbl th{ background:#f6f1d9; color:#5b5534; padding:10px; font-weight:800; border-bottom:1px solid var(--line); }
    .tbl td{ padding:10px; border-top:1px solid var(--line); }
    .tbl tbody tr:nth-child(even){ background:#fffef9; }
    .tbl input[type="number"]{ width:90px; height:34px; text-align:right; }
    .right{ text-align:right; }
    .mono{ font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,"Liberation Mono",monospace; }
    .grid-2{ display:grid; grid-template-columns:1fr 1fr; gap:14px; }
    @media (max-width:860px){ .grid-2{ grid-template-columns:1fr; } }
    .row-mid{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
    .pill-note{ display:inline-block; padding:2px 8px; border:1px solid var(--line); border-radius:999px; background:#fff; font-weight:700; color:#333; }
  </style>
</head>
<body>
  <!-- 浮水印 -->
  <div class="watermark" aria-hidden="true">
    <span class="wm-item" style="top:5%; left:5%; --dur:9s;">@hori版權所有</span>
    <span class="wm-item" style="top:5%; left:35%; --dur:11s;">@hori版權所有</span>
    <span class="wm-item" style="top:5%; left:65%; --dur:10s;">@hori版權所有</span>
    <span class="wm-item" style="top:25%; left:10%; --dur:13s;">@hori版權所有</span>
    <span class="wm-item" style="top:25%; left:40%; --dur:12s;">@hori版權所有</span>
    <span class="wm-item" style="top:25%; left:70%; --dur:14s;">@hori版權所有</span>
    <span class="wm-item" style="top:50%; left:5%; --dur:10s;">@hori版權所有</span>
    <span class="wm-item" style="top:50%; left:35%; --dur:11s;">@hori版權所有</span>
    <span class="wm-item" style="top:50%; left:65%; --dur:9s;">@hori版權所有</span>
    <span class="wm-item" style="top:75%; left:10%; --dur:13s;">@hori版權所有</span>
    <span class="wm-item" style="top:75%; left:40%; --dur:12s;">@hori版權所有</span>
    <span class="wm-item" style="top:75%; left:70%; --dur:10s;">@hori版權所有</span>
    <span class="wm-item" style="top:90%; left:15%; --dur:11s;">@hori版權所有</span>
    <span class="wm-item" style="top:90%; left:45%; --dur:10s;">@hori版權所有</span>
    <span class="wm-item" style="top:90%; left:75%; --dur:12s;">@hori版權所有</span>
  </div>

  <!-- 導覽（右上角放：列印／全部清空） -->
  <header class="topbar">
    <div class="brand">
      <a href="https://github.com/hori07/longterm-care-calculator/tree/main" target="_blank" class="logo-link">
        <img src="org-logo.png" alt="logo" onerror="this.style.opacity=0.2" />
      </a>
      <span class="site-title">薪資計算機</span>
    </div>

    <nav class="nav-links">
      <a href="index.html">額度計算機</a>
      <a href="payroll.html">薪資計算機</a>
      <a href="care-info.html">長照相關資訊</a>
      <a href="news.html">最新公告</a>
      <a href="contact.html">聯繫方式</a>
      <a href="about.html">關於我們</a>
    </nav>

    <div class="actions">
      <button class="btn pill btn-gray" id="btnPrint" type="button">列印</button>
      <button class="btn pill btn-green" id="btnResetAll" type="button">全部清空</button>
    </div>
  </header>

  <div class="divider"></div>

  <main class="container">
    <!-- KPI -->
    <section class="card" style="margin-bottom:16px;">
      <h1 class="card-title" style="font-size:22px;">本月薪資總覽</h1>
      <p class="hint">輸入各碼別本月支數 → 計總額 → 依比例拆薪；右側即時比對勞健保扣款，算出「實領」。</p>
      <div class="kpi" style="margin-top:10px;">
        <div class="box"><div class="lbl">AA 小計</div><div class="num" id="kpiAA">0</div></div>
        <div class="box"><div class="lbl">BA 小計</div><div class="num" id="kpiBA">0</div></div>
        <div class="box"><div class="lbl">GA 小計</div><div class="num" id="kpiGA">0</div></div>
        <div class="box"><div class="lbl">SC 小計</div><div class="num" id="kpiSC">0</div></div>
        <div class="box"><div class="lbl">全月總額</div><div class="num" id="kpiTotal">0</div></div>
        <div class="box"><div class="lbl">拆薪後薪資</div><div class="num" id="kpiSalary">0</div></div>
        <div class="box"><div class="lbl">勞健保合計</div><div class="num" id="kpiIns">0</div></div>
        <div class="box"><div class="lbl">實領</div><div class="num" id="kpiNet">0</div></div>
      </div>
    </section>

    <!-- 拆薪比例 -->
    <section class="card">
      <h2 class="card-title">① 拆薪比例</h2>
      <div class="grid-2" style="margin-top:8px;">
        <div class="row-mid">
          <label style="min-width:120px;font-weight:700;">拆薪比例（%）</label>
          <input id="ratioPct" type="number" min="0" max="100" step="0.1" value="60" style="height:34px;width:120px;text-align:right;">
          <span class="hint">例：6/4 → 填 60</span>
        </div>
        <div class="row-mid">
          <label style="min-width:120px;font-weight:700;">月份</label>
          <input id="plMonth" type="month" style="height:34px;width:180px;">
        </div>
      </div>
    </section>

    <!-- AA -->
    <section class="card">
      <h2 class="card-title">② AA 本月支數</h2>
      <table class="tbl" id="tblAA">
        <thead><tr><th style="min-width:220px;">代碼</th><th class="right">單價</th><th class="right">本月支數</th><th class="right">小計</th></tr></thead>
        <tbody></tbody>
        <tfoot><tr><th colspan="3" class="right">AA 小計</th><th class="right" id="sumAA">0</th></tr></tfoot>
      </table>
      <p class="hint" style="margin-top:8px;">單價：AA05 200、AA06 200、AA08 385、AA09 770、AA11 50（與首頁一致）。</p>
    </section>

    <!-- BA -->
    <section class="card">
      <h2 class="card-title">③ BA 本月支數</h2>
      <table class="tbl" id="tblBA">
        <thead><tr><th style="min-width:260px;">代碼＋名稱</th><th class="right">單價</th><th class="right">本月支數</th><th class="right">小計</th></tr></thead>
        <tbody></tbody>
        <tfoot><tr><th colspan="3" class="right">BA 小計</th><th class="right" id="sumBA">0</th></tr></tfoot>
      </table>
    </section>

    <!-- GA -->
    <section class="card">
      <h2 class="card-title">④ GA 本月支數</h2>
      <table class="tbl" id="tblGA">
        <thead><tr><th style="min-width:220px;">代碼＋名稱</th><th class="right">單價</th><th class="right">本月支數</th><th class="right">小計</th></tr></thead>
        <tbody></tbody>
        <tfoot><tr><th colspan="3" class="right">GA 小計</th><th class="right" id="sumGA">0</th></tr></tfoot>
      </table>
    </section>

    <!-- SC -->
    <section class="card">
      <h2 class="card-title">⑤ SC 本月支數</h2>
      <table class="tbl" id="tblSC">
        <thead><tr><th style="min-width:220px;">代碼＋名稱</th><th class="right">單價</th><th class="right">本月支數</th><th class="right">小計</th></tr></thead>
        <tbody></tbody>
        <tfoot><tr><th colspan="3" class="right">SC 小計</th><th class="right" id="sumSC">0</th></tr></tfoot>
      </table>
    </section>

    <!-- 結果＋勞健保：並排 -->
    <section class="card">
      <h2 class="card-title">⑥ 薪資結果 & 勞健保扣款</h2>
      <div class="grid-2" style="margin-top:8px;">
        <!-- 左：薪資彙總 -->
        <div class="card" style="padding:14px;">
          <table class="tbl">
            <tbody>
              <tr><td>AA 小計</td><td class="right mono" id="resAA">0</td></tr>
              <tr><td>BA 小計</td><td class="right mono" id="resBA">0</td></tr>
              <tr><td>GA 小計</td><td class="right mono" id="resGA">0</td></tr>
              <tr><td>SC 小計</td><td class="right mono" id="resSC">0</td></tr>
              <tr><td><b>全月總額（AA+BA+GA+SC）</b></td><td class="right mono" id="resTotal"><b>0</b></td></tr>
              <tr><td>拆薪比例</td><td class="right mono"><span id="resRatio">60</span>%</td></tr>
              <tr><td><b>拆薪後薪資</b></td><td class="right mono" id="resSalary"><b>0</b></td></tr>
              <tr><td><b>實領（扣勞健保）</b></td><td class="right mono" id="resNet"><b>0</b></td></tr>
            </tbody>
          </table>
        </div>

        <!-- 右：勞健保（移入這裡） -->
        <div class="card" style="padding:14px;">
          <div class="row-mid" style="margin-bottom:10px;">
            <span class="pill-note">自動依「拆薪後薪資」抓 ≤ 薪資的最大投保級距</span>
          </div>
          <table class="tbl">
            <thead>
              <tr>
                <th>投保級距</th>
                <th class="right">勞保（員工）</th>
                <th class="right">健保（員工）</th>
                <th class="right">合計</th>
                <th style="width:180px;">設定</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><select id="insGrade" style="height:34px;min-width:140px;"></select></td>
                <td class="right"><input id="insLabor" type="number" min="0" step="1" value="0" style="height:34px;width:110px;text-align:right;"></td>
                <td class="right"><input id="insHealth" type="number" min="0" step="1" value="0" style="height:34px;width:110px;text-align:right;"></td>
                <td class="right mono" id="insSum">0</td>
                <td>
                  <label class="chip" style="cursor:pointer;">
                    <input id="insAuto" type="checkbox" checked> 自動帶入金額
                  </label>
                </td>
              </tr>
            </tbody>
          </table>
          <div class="row-mid" style="margin-top:12px;">
            <div class="pill-note">實領（拆薪後薪資－勞健保合計）：<b class="mono" id="netPay">0</b></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer id="bottomDock" class="footerbar">
    <div class="foot">
      <span class="ok">※ 以上勞／健保金額為員工自付部分的參考表（可改）。不同公司可能採用不同的投保級距，請以實際投保為準。</span>
    </div>
  </footer>

  <!-- 本頁專屬邏輯 -->
  <script>
    (function(){
      const $  = s => document.querySelector(s);
      const $$ = s => Array.from(document.querySelectorAll(s));
      const N  = v => (isFinite(+v) ? +v : 0);
      const F  = v => new Intl.NumberFormat('zh-Hant-TW', { maximumFractionDigits: 0 }).format(v);

      /* === 單價（沿用你的定義） === */
      const PRICE = {
        AA: { AA05:200, AA06:200, AA08:385, AA09:770, AA11:50 },
        BA: [
          { code:"BA01", name:"基本身體清潔", price:260 },
          { code:"BA02", name:"基本日常照顧", price:195 },
          { code:"BA03", name:"測量生命徵象", price:35 },
          { code:"BA04", name:"協助進食或管灌", price:130 },
          { code:"BA05", name:"餐食照顧", price:310 },
          { code:"BA07", name:"協助沐浴及洗頭", price:325 },
          { code:"BA08", name:"足部照護", price:500 },
          { code:"BA09", name:"到宅沐浴-1", price:2200 },
          { code:"BA09a", name:"到宅沐浴-2", price:2500 },
          { code:"BA10", name:"翻身拍背", price:155 },
          { code:"BA11", name:"肢體關節活動", price:195 },
          { code:"BA12", name:"協助上下樓梯", price:130 },
          { code:"BA13", name:"陪同外出", price:195 },
          { code:"BA14", name:"陪同就醫", price:685 },
          { code:"BA15", name:"家務協助", price:195 },
          { code:"BA16", name:"代購", price:130 },
          { code:"BA17a", name:"人工氣道管抽吸", price:75 },
          { code:"BA17b", name:"口腔內抽吸", price:65 },
          { code:"BA17c", name:"管路清潔", price:50 },
          { code:"BA17d", name:"通便/驗血糖", price:50 },
          { code:"BA17e", name:"依指示置入藥盒", price:50 },
          { code:"BA18", name:"安全看視", price:200 },
          { code:"BA20", name:"陪伴服務", price:175 },
          { code:"BA22", name:"巡視服務", price:130 },
          { code:"BA23", name:"協助洗頭", price:200 },
          { code:"BA24", name:"協助排泄", price:220 }
        ],
        GA: [{ code:"GA09", name:"喘息 2 小時/支", price:770 }],
        SC: [{ code:"SC09", name:"短照 2 小時/支", price:770 }]
      };

      /* === 勞健保級距表（員工自付，依你圖片建表） === */
      const INS_TABLE = [
        { grade:11100, labor:277, health:443 }, { grade:12540, labor:313, health:443 },
        { grade:13500, labor:338, health:443 }, { grade:15840, labor:396, health:443 },
        { grade:16500, labor:413, health:443 }, { grade:17280, labor:432, health:443 },
        { grade:19047, labor:476, health:443 }, { grade:20008, labor:505, health:443 },
        { grade:21009, labor:525, health:443 }, { grade:22000, labor:550, health:443 },
        { grade:23100, labor:577, health:443 }, { grade:24000, labor:600, health:443 },
        { grade:25250, labor:632, health:443 }, { grade:26400, labor:660, health:443 },
        { grade:27600, labor:690, health:443 }, { grade:28590, labor:715, health:443 },
        { grade:28800, labor:720, health:447 }, { grade:30300, labor:758, health:472 },
        { grade:31800, labor:795, health:493 }, { grade:33300, labor:833, health:516 },
        { grade:34800, labor:870, health:540 }, { grade:36300, labor:908, health:563 },
        { grade:38200, labor:955, health:592 }, { grade:40100, labor:1002, health:622 },
        { grade:41900, labor:1045, health:651 }, { grade:43900, labor:1098, health:681 },
        { grade:45800, labor:1145, health:710 }, { grade:50600, labor:1145, health:785 },
        { grade:53000, labor:1145, health:822 }, { grade:55400, labor:1145, health:859 },
        { grade:57800, labor:1145, health:896 }, { grade:60800, labor:1145, health:943 },
        { grade:63800, labor:1145, health:990 }, { grade:66800, labor:1145, health:1036 },
        { grade:69800, labor:1145, health:1083 }, { grade:72800, labor:1145, health:1129 },
        { grade:76500, labor:1145, health:1187 }, { grade:80200, labor:1145, health:1244 },
        { grade:83900, labor:1145, health:1301 }, { grade:87600, labor:1145, health:1359 },
        { grade:92100, labor:1145, health:1428 }, { grade:96600, labor:1145, health:1498 },
        { grade:101100, labor:1145, health:1568 }, { grade:105600, labor:1145, health:1638 },
        { grade:110100, labor:1145, health:1708 }, { grade:115500, labor:1145, health:1791 },
        { grade:120900, labor:1145, health:1875 }, { grade:126300, labor:1145, health:1959 },
        { grade:131700, labor:1145, health:2043 }, { grade:137100, labor:1145, health:2126 },
        { grade:142500, labor:1145, health:2210 }, { grade:147900, labor:1145, health:2294 },
        { grade:150000, labor:1145, health:2327 }
      ];

      /* === 建表（輸入） === */
      function buildAA(){
        const host = $('#tblAA tbody'); host.innerHTML = '';
        const saved = loadLS('pl-aa', {});
        Object.keys(PRICE.AA).forEach(code=>{
          const price = PRICE.AA[code];
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${code}</td>
            <td class="right mono">${F(price)}</td>
            <td class="right"><input type="number" min="0" step="1" value="${N(saved[code]||0)}" data-aa="${code}"></td>
            <td class="right mono" data-aa-sum="${code}">0</td>`;
          host.appendChild(tr);
        });
      }
      function buildGroup(tableId, key, savedKey){
        const host = $(`#${tableId} tbody`); host.innerHTML = '';
        const saved = loadLS(savedKey, {});
        PRICE[key].forEach(item=>{
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${item.code}${item.name ? ' ' + item.name : ''}</td>
            <td class="right mono">${F(item.price)}</td>
            <td class="right"><input type="number" min="0" step="1" value="${N(saved[item.code]||0)}" data-${key}="${item.code}"></td>
            <td class="right mono" data-${key}-sum="${item.code}">0</td>`;
          host.appendChild(tr);
        });
      }

      /* === 計算 === */
      function calcAA(){
        let total = 0;
        Object.keys(PRICE.AA).forEach(code=>{
          const qty = N($(`input[data-aa="${code}"]`)?.value);
          const sub = qty * PRICE.AA[code];
          $(`td[data-aa-sum="${code}"]`).textContent = F(sub);
          total += sub;
        });
        $('#sumAA').textContent = F(total);
        $('#kpiAA').textContent = F(total);
        $('#resAA').textContent = F(total);
        return total;
      }
      function calcGroup(key, sumId, kpiId, resId){
        let total = 0;
        PRICE[key].forEach(item=>{
          const qty = N($(`input[data-${key}="${item.code}"]`)?.value);
          const sub = qty * item.price;
          $(`td[data-${key}-sum="${item.code}"]`).textContent = F(sub);
          total += sub;
        });
        $(sumId).textContent = F(total);
        $(kpiId).textContent = F(total);
        $(resId).textContent = F(total);
        return total;
      }

      function updateAll(){
        const sumAA = calcAA();
        const sumBA = calcGroup('BA', '#sumBA', '#kpiBA', '#resBA');
        const sumGA = calcGroup('GA', '#sumGA', '#kpiGA', '#resGA');
        const sumSC = calcGroup('SC', '#sumSC', '#kpiSC', '#resSC');

        const total = sumAA + sumBA + sumGA + sumSC;
        $('#kpiTotal').textContent = F(total);
        $('#resTotal').textContent = F(total);

        const ratioPct = N($('#ratioPct').value) || 0;
        const ratio = ratioPct / 100;
        $('#resRatio').textContent = ratioPct;
        const salary = Math.round(total * ratio);
        $('#kpiSalary').textContent = F(salary);
        $('#resSalary').textContent = F(salary);

        syncInsuranceBySalary(salary);
        saveAll();
      }

      /* === 勞健保 === */
      function buildInsOptions(){
        const sel = $('#insGrade'); sel.innerHTML = '';
        INS_TABLE.forEach(row=>{
          const opt = document.createElement('option');
          opt.value = row.grade;
          opt.textContent = row.grade.toLocaleString('zh-TW');
          sel.appendChild(opt);
        });
      }
      function findGradeBySalary(sal){
        const list = INS_TABLE.map(r=>r.grade).sort((a,b)=>a-b);
        let g = list[0];
        for (const v of list){ if (v <= sal) g = v; else break; }
        return g;
      }
      function getRow(grade){
        return INS_TABLE.find(r=>r.grade===grade) || INS_TABLE[0];
      }
      function syncInsuranceBySalary(salary){
        const auto = $('#insAuto').checked;
        const sel  = $('#insGrade');
        const autoGrade = findGradeBySalary(salary);
        if (auto && N(sel.value)!==autoGrade) sel.value = String(autoGrade);
        const row = getRow(N(sel.value) || autoGrade);
        if (auto){
          $('#insLabor').value  = row.labor;
          $('#insHealth').value = row.health;
        }
        const insSum = N($('#insLabor').value) + N($('#insHealth').value);
        $('#insSum').textContent = F(insSum);
        $('#kpiIns').textContent = F(insSum);

        const net = Math.max(0, (salary - insSum));
        $('#netPay').textContent = F(net);
        $('#kpiNet').textContent = F(net);
        $('#resNet').textContent = F(net);
      }

      /* === 儲存／還原 === */
      function saveAll(){
        const aa = {}; Object.keys(PRICE.AA).forEach(code=> aa[code]=N($(`input[data-aa="${code}"]`).value));
        localStorage.setItem('pl-aa', JSON.stringify(aa));
        ['BA','GA','SC'].forEach(key=>{
          const obj={}; PRICE[key].forEach(item=> obj[item.code]=N($(`input[data-${key}="${item.code}"]`).value));
          localStorage.setItem(`pl-${key.toLowerCase()}`, JSON.stringify(obj));
        });
        const params = {
          month: $('#plMonth').value || '',
          ratio: N($('#ratioPct').value),
          insGrade: N($('#insGrade').value)||0,
          insLabor: N($('#insLabor').value)||0,
          insHealth: N($('#insHealth').value)||0,
          insAuto: $('#insAuto').checked ? 1 : 0
        };
        localStorage.setItem('pl-params', JSON.stringify(params));
      }
      function loadLS(key, fb){ try{ return JSON.parse(localStorage.getItem(key)||'') || fb; }catch(e){ return fb; } }
      function restore(){
        const p = loadLS('pl-params', null);
        if (p){
          if (p.month) $('#plMonth').value = p.month;
          if (p.ratio!=null) $('#ratioPct').value = p.ratio;
          if (p.insGrade) $('#insGrade').value = p.insGrade;
          if (p.insLabor!=null) $('#insLabor').value = p.insLabor;
          if (p.insHealth!=null) $('#insHealth').value = p.insHealth;
          $('#insAuto').checked = !!p.insAuto;
        }
      }

      /* === 事件 === */
      function wire(){
        $$('#tblAA input[type="number"], #tblBA input[type="number"], #tblGA input[type="number"], #tblSC input[type="number"]').forEach(inp=>{
          inp.addEventListener('input', updateAll);
        });
        $('#ratioPct').addEventListener('input', updateAll);
        $('#plMonth').addEventListener('change', saveAll);

        // 勞健保事件
        $('#insGrade').addEventListener('change', ()=>{
          if ($('#insAuto').checked){
            const row = getRow(N($('#insGrade').value));
            $('#insLabor').value = row.labor;
            $('#insHealth').value = row.health;
          }
          syncInsuranceBySalary(N($('#resSalary').textContent.replace(/,/g,'')));
          saveAll();
        });
        $('#insLabor').addEventListener('input', ()=>{
          $('#insAuto').checked = false;
          syncInsuranceBySalary(N($('#resSalary').textContent.replace(/,/g,'')));
          saveAll();
        });
        $('#insHealth').addEventListener('input', ()=>{
          $('#insAuto').checked = false;
          syncInsuranceBySalary(N($('#resSalary').textContent.replace(/,/g,'')));
          saveAll();
        });
        $('#insAuto').addEventListener('change', ()=>{
          syncInsuranceBySalary(N($('#resSalary').textContent.replace(/,/g,'')));
          saveAll();
        });

        // 右上角按鈕
        $('#btnPrint').addEventListener('click', ()=>window.print());
        $('#btnResetAll').addEventListener('click', ()=>{
          ['pl-aa','pl-ba','pl-ga','pl-sc','pl-params'].forEach(k=>localStorage.removeItem(k));
          location.reload();
        });
      }

      /* === 啟動 === */
      buildAA();
      buildGroup('tblBA','BA','pl-ba');
      buildGroup('tblGA','GA','pl-ga');
      buildGroup('tblSC','SC','pl-sc');
      buildInsOptions();
      restore();
      wire();
      updateAll();

      /* 導覽高亮（確保本頁一定亮） */
      (function(){
        const here = location.pathname.toLowerCase();
        document.querySelectorAll('.nav-links a[href]').forEach(a=>{
          const href = a.getAttribute('href')?.toLowerCase() || '';
          if (/(^|\/)payroll(\.html)?$/.test(href) && /(payroll(\.html)?$)/.test(here)){
            a.classList.add('active');
          }
        });
      })();

      /* 防拷（與首頁一致） */
      document.addEventListener('contextmenu', e => e.preventDefault());
      document.addEventListener('keydown', e => {
        if ((e.ctrlKey || e.metaKey) && ['u','s','p'].includes(e.key.toLowerCase())) e.preventDefault();
        if (e.key === 'F12') e.preventDefault();
      });
      document.addEventListener('selectstart', e => e.preventDefault());
      document.addEventListener('copy', e => e.preventDefault());
    })();
  </script>
</body>
</html>
